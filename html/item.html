<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/item.css">
</head>

<body>
    <div id="extend-top">
        <div class="banner-wp">
            <div class="fl">
                <span>京东首页</span>
                <span>北京</span>
            </div>
            <div class="nav-list">
                <ul class="nav-list-ul">
                    <li>
                        <a href="">你好，请登录</a>
                        <a href="" class="nav-list-a">免费注册</a>
                    </li>
                    <li><a href="">我的订单</a></li>
                    <li><a href="">我的京东</a></li>
                    <li><a href="">京东会员</a></li>
                    <li><a href="">企业采购</a></li>
                    <li><a href="">客户服务</a></li>
                    <li><a href="">网站导航</a></li>
                    <li class="nav-list"><a href="">手机京东</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div id="extend-nav">
        <div class="banner-wp2">
            <div class="log-jd">
                <img src="../img/34.png" alt="">
            </div>
            <div class="classify">
                <p>全部分类</p>
            </div>
            <div class="search-wp">
                <div class="search-ipt">
                    <input type="text">
                    <div class="search-btn-a">
                        <p>搜全站</p>
                    </div>
                    <div class="search-btn-b">
                        <p>搜本店</p>
                    </div>
                </div>
                <div class="nav-list3">
                    <ul>
                        <li>电子烟戒烟</li>
                        <li>打火机充电</li>
                        <li>创意礼品</li>
                        <li>生日礼物</li>
                        <li>绿植</li>
                        <li>美妆礼品</li>
                        <li>鲜花</li>
                        <li>戒烟器</li>
                    </ul>
                </div>
            </div>
            <div class="cart">
                <p><a href="cart.html">我的购物车</a></p>
                <span>0</span>
            </div>
        </div>
    </div>
    <div class="interval"></div>

    <div class="item-wp">
        <!-- <div class="product-picture">
            <img src="" alt="">
        </div>
        
        <div class="content-wp">
            <div class="name-wp">
                <img src="../img/35.png" alt="">
                <p>缔晶 七夕情人节礼物送女友老婆缔晶 七夕情人节礼物送女友老婆</p>
            </div>
            <div class="content-price">
                <b>京东价</b>
                <span>￥268.00元</span>
            <div>
            <div class="content-bourn">
                <p>配送到</p>
                <input type="text" placeholder="北京朝阳区三环以内">
            </div>         
        </div>  -->    
        
        <div class="product-picture">
            <img src="../img/" alt="">
            <div id="move"></div>
            <div id="bimg">
                <img id="b-bimg" src="" alt="">
            </div>
        </div>
        <div class="content-wp">
            <div class="name-wp">
                <img src="../img/35.png" alt="">
                <p class="sp-name"></p>
            </div>
            <div class="content-price">
                <b>京东价</b>
                <span></span>
            <div>
            <div class="content-bourn">
                <p>配送到</p>
                <input type="text" placeholder="北京朝阳区三环以内">
            </div>
            
            
        </div>  
        
        </div>  
    
        <div class="number">
            <input type="button" value="_" class="number-sub">
            <input type="text" value="1" class="number-n">
            <input type="button" value="+" class="number-push">
            <div class="cart-btn">
                <button>加入购物车</button>
            </div>
        </div>
            <script src="../js/axios.min.js"></script>
            <script src="../js/jquery.min.js"></script>

            <script>
                $(function () {
                    let url = 'http://jx.xuzhixiang.top/ap/api/detail.php'
                    let params = new URLSearchParams(location.search)
                    let id = params.get('pid')
                    console.log(id)
                    $.get(url, { id }, data => {
                        console.log(data)
                        let obj = data.data
                        console.log(obj)
                        $('.product-picture img').attr("src",data.data.pimg)
                        $('.sp-name').html(data.data.pdesc)
                        $('.content-price span').html(data.data.pprice)
                        // let html = `
                        //         <div class="product-picture">
                        //             <img src="${obj.pimg}" alt="">
                                    
                        //         </div>
                        //         <div class="content-wp">
                        //             <div class="name-wp">
                        //                 <img src="../img/35.png" alt="">
                        //                 <p>${obj.pdesc}</p>
                        //             </div>
                        //             <div class="content-price">
                        //                 <b>京东价</b>
                        //                 <span>￥${obj.pprice}元</span>
                        //             <div>
                        //             <div class="content-bourn">
                        //                 <p>配送到</p>
                        //                 <input type="text" placeholder="北京朝阳区三环以内">
                        //             </div>
                                    
                                    
                        //         </div>  
                        //     `
                        // $('.item-wp').html(html)
                    })
                    // 商品数量+
                    $('.number-push').click(function(){
                        console.log(333)
                        let n = $('.number-n')
                            n.val(parseInt(n.val())+1)
                    })
                    // 商品数量-
                    $('.number-sub').click(function(){
                        console.log(333)
                        let j = $('.number-n')
                        if(j.val()==1){
                            return
                        }
                            j.val(parseInt(j.val())-1)
                    })
                    let addCartBtn = document.querySelector('.cart-btn button')
                    console.log(addCartBtn)
                    addCartBtn.onclick =async function(){
                        let uid = localStorage.getItem('id')
                        let pname = $('.number-n').val()
                        console.log(pname)
                        let params={
                            uid,
                            pid:id,
                            pname,
                        }
                        // let url = 'http://jx.xuzhixiang.top/ap/api/add-product.php',
                        try {
                            let res = await axios.get('http://jx.xuzhixiang.top/ap/api/add-product.php',{params})
                            console.log(res.data)
                            alert('加入购物车成功')
                        } catch (error) {
                            alert('加入购物车失败')
                        }
                        
                    }        
                    
                })

                bigimg()
            function bigimg(){
                let bbox = document.querySelector('.product-picture');
                let bmove = document.querySelector('#move');
                let bbimg = document.querySelector('#bimg');
                let b_bimg = document.querySelector('#b-bimg');

                bbox.onmouseover = function(){
                    bbimg.style.display = "block";
                    bmove.style.display = 'block';
                }
                bbox.onmouseout = function(){
                    bbimg.style.display = 'none'
                    bmove.style.display = 'none'
                }
                bbox.onmousemove = function(e){
                    //获取鼠标相对于视口（当前页面）的位置
                    let x = e.clientX;
                    // console.log(x)
                    let y = e.clientY;
                    let t = bbox.offsetTop;
                    // console.log(t)
                    let l = bbox.offsetLeft;
                    let _left = x-l - bmove.offsetWidth/2;
                    // let w = bmove.offsetWidth
                    // console.log(w)
                    // console.log(_left)
                    let _top = y-t-bmove.offsetHeight/2;
                    console.log(_top)
                    if(_top<=0)
                        _top=0;
                    else if(_top>=bbox.offsetHeight-bmove.offsetHeight)
                    _top = bbox.offsetHeight-bmove.offsetHeight;
                    if(_left<=0)
                    _left=0;
                    else if(_left>=bbox.offsetWidth-bmove.offsetWidth)
                    _left = bbox.offsetWidth-bmove.offsetWidth;

                    bmove.style.top = _top+'px';
                    bmove.style.left = _left+'px';
                    let  w = _left/(bbox.offsetWidth-bmove.offsetWidth)
                    let h = _top/(bbox.offsetHeight-bmove.offsetHeight)
                    var b_bimg_top = (b_bimg.offsetHeight-bbimg.offsetHeight)*h;//计算大图的位置
                    var b_bimg_left = (b_bimg.offsetWidth-bbimg.offsetWidth)*w;
                    b_bimg.style.top = -b_bimg_top + "px";//设置大图的位置信息
                    b_bimg.style.left = -b_bimg_left + "px"; 
                }
            }
        </script>
</body>

</html>